// Function to toggle additional inputs based on code selection
function toggleInputs() {
var selectElement = document.getElementById('codeSelect');
var additionalInputsRevCat = document.getElementById('additionalInputsRevCat');
var userCodeInput = document.getElementById('userCode');
var generateButton = document.getElementById('genBtn');

generateButton.style.display = 'block';

if (selectElement.value === 'selectCode') {
    additionalInputsOther.style.display = 'none';
    additionalInputsRevCat.style.display = 'none';
    userCodeInput.style.display = 'none';
    generateButton.style.display = 'none';
} else if (selectElement.value === 'code1') {
    userCodeInput.style.display = 'none';
    additionalInputsRevCat.style.display = 'block';
    additionalInputsOther.style.display = 'none';
}
else if (selectElement.value === 'code2' || 'code3' || 'code4') {
    additionalInputsRevCat.style.display = 'none';
    additionalInputsOther.style.display = 'block';
    userCodeInput.style.display = 'block';
} else {
    additionalInputsRevCat.style.display = 'none';
    userCodeInput.style.display = 'block';
}
}

// Function to generate the script based on user inputs
function generateScript() {
var selectedCode = document.getElementById('codeSelect').value;
var userCode = document.getElementById('userCode').value.trim(); // Get user's custom code
var entValue = document.getElementById('entitlement').value.trim();
var prodIDValue = document.getElementById('productID').value.trim();
var containsStringOne = document.getElementById('containsString1').value.trim();
var containsStringTwo = document.getElementById('containsString2').value.trim();


var highlightCode = '';

// Define existing codes
var code1 = 
`#import <Foundation/Foundation.h>

%hook NSURLSession
- (id)dataTaskWithRequest:(NSMutableURLRequest *)request completionHandler:(void (^)(NSData *data, NSURLResponse *response, NSError *error))completionHandler {
void (^customCompletion)(NSData *data, NSURLResponse *response, NSError *error) = ^(NSData *data, NSURLResponse *response, NSError *error) {
if (([request.URL.absoluteString containsString:@"subscribers"] || [request.URL.absoluteString containsString:@"receipt"]) && (![request.URL.absoluteString containsString:@"offerings"])) {
NSDictionary *dict = @{
    @"request_date": @"2023-08-02T02:21:57Z",
    @"request_date_ms": @1690942917283,
    @"subscriber": @{
        @"entitlements": @{
            @"${entValue}": @{
                @"expires_date": @"2099-02-18T07:52:54Z",
                @"original_purchase_date": @"2020-02-11T07:52:55Z",
                @"purchase_date": @"2020-02-11T07:52:54Z",
                @"product_identifier": @"${prodIDValue}"
            }
        },
        @"first_seen": @"2023-07-27T12:47:03Z",
        @"last_seen": @"2023-08-02T01:57:17Z",
        @"management_url": NSNull.null,
        @"non_subscriptions": @{
        },
        @"original_app_user_id": @"70B24288-83C4-4035-B001-573285B21AE2",
        @"original_application_version": @"3",
        @"original_purchase_date": @"2023-07-26T17:04:14Z",
        @"other_purchases": @{
        },
        @"subscriptions": @{
            @"${prodIDValue}": @{
                @"expires_date": @"2099-02-18T07:52:54Z",
                @"original_purchase_date": @"2020-02-11T07:52:55Z",
                @"purchase_date": @"2020-02-11T07:52:54Z"
            }
        },
        @"entitlement": @{
        }
    }
};
data = [NSJSONSerialization dataWithJSONObject:dict options:0 error:nil];
}
completionHandler(data, response, error);
};
return %orig(request, customCompletion);
}
%end`;

var code2 = 
`#import <Foundation/Foundation.h>

%hook AFURLSessionManager
// Generated using DCG by D3WXY
-(void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)task didReceiveData:(NSData *)data {
if ([task.currentRequest.URL.absoluteString containsString:@"${containsStringOne}"]) {
NSDictionary *dict = "User Code HERE"


// Generated using DCG by D3WXY
data = [NSJSONSerialization dataWithJSONObject:dict options:0 error:0];
}
// Generated using DCG by D3WXY
%orig(session, task, data);
}
// Generated using DCG by D3WXY
%end`;


var code3 = 
`#import <Foundation/Foundation.h>

%hook SessionDelegate
// Generated using DCG by D3WXY
-(void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)task didReceiveData:(NSData *)data {
if ([task.currentRequest.URL.absoluteString containsString:@"${containsStringOne}"]) {
NSDictionary *dict = "User Code HERE"


// Generated using DCG by D3WXY
data = [NSJSONSerialization dataWithJSONObject:dict options:0 error:0];
}
%orig(session, task, data);
}
// Generated using DCG by D3WXY
%end

%ctor {
%init(SessionDelegate = objc_getClass("Alamofire.SessionDelegate"));
}`;


var code4 = 
`#import  <Foundation/Foundation.h>

%hook HttpAsynConnection
// Generated using DCG by D3WXY
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
NSURLRequest *originalRequest = [connection originalRequest];
NSString *urlString = [[originalRequest URL] absoluteString];
// Generated using DCG by D3WXY
if ([urlString containsString:@"${containsStringOne}"]) {
NSDictionary *dict = "User Code HERE"


// Generated using DCG by D3WXY
NSError *error = nil;
NSData *modifiedData = [NSJSONSerialization dataWithJSONObject:dict options:0 error:&error];
if (!error) {
%orig(connection, modifiedData);
} else {
%orig(connection, data);
}
} else {
%orig(connection, data);
}
}
// Generated using DCG by D3WXY
%end`;

var code5 = `There isnt another template, if you have one. DM me (@D3WXY) on Telegram`;

// Select the appropriate code based on the user's selection
switch(selectedCode) {
    case 'code1':
        highlightCode = code1;
        break;
    case 'code2':
        highlightCode = code2;
        break;
    case 'code3':
        highlightCode = code3;
        break;
    case 'code4':
        highlightCode = code4;
        break;
    case 'code5':
        highlightCode = code5;
        break;
    // Add more cases for each existing code
    default:
        highlightCode = ''; // Handle default case
}

// Merge user's code with selected code
highlightCode = highlightCode.replace('"User Code HERE"', userCode);
highlightCode = highlightCode.replace('${entValue}', entValue);
highlightCode = highlightCode.replace('${prodIDValue}', prodIDValue);

document.getElementById('highlightCode').textContent = highlightCode;
// Copy the generated script to the clipboard
navigator.clipboard.writeText(highlightCode).then(function () {
    console.log('Script copied to clipboard');
}, function (err) {
    console.error('Failed to copy script: ', err);
});
}

// Check if dark mode preference is stored
const isDarkMode = localStorage.getItem('darkMode') === 'true';

// Function to set dark mode based on preference
function setDarkMode() {
    const body = document.body;
    const darkModeToggle = document.getElementById('darkModeToggle');

    if (isDarkMode) {
        body.classList.add('dark-mode');
        darkModeToggle.textContent = 'Light Mode';
    } else {
        body.classList.remove('dark-mode');
        darkModeToggle.textContent = 'Dark Mode';
    }
}

// Toggle dark mode and save user preference
function toggleDarkMode() {
    const body = document.body;
    const darkModeToggle = document.getElementById('darkModeToggle');

    body.classList.toggle('dark-mode');
    if (body.classList.contains('dark-mode')) {
        darkModeToggle.textContent = 'Light Mode';
        localStorage.setItem('darkMode', 'true');
    } else {
        darkModeToggle.textContent = 'Dark Mode';
        localStorage.setItem('darkMode', 'false');
    }
}

// Call setDarkMode function to apply preference on page load
setDarkMode();

// Add event listener to dark mode toggle button
document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
